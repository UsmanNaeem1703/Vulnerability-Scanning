<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OpenVAS Automation Form</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    <script>
        function showProgressMessage() {
            document.getElementById('progress-message').style.display = 'block';
            document.getElementById('progress-bar').style.display = 'block';
        }

        function updateProgress(taskId) {
            const progressBar = document.getElementById('progress-bar');
            const progressPercent = document.getElementById('progress-percent');

            fetch(`/task_progress/${taskId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        const progress = data.progress;
                        progressBar.value = progress;
                        progressPercent.innerText = progress + '%';

                        if (progress < 100) {
                            setTimeout(() => updateProgress(taskId), 3000);  // Poll every 3 seconds
                        } else {
                            window.location.href = '/thank_you';
                        }
                    } else {
                        console.error(data.message);
                    }
                })
                .catch(error => console.error('Error:', error));
        }
    </script>
</head>
<body>
    <h1>Start Scanning</h1>
    <form action="/automate/openvas" method="POST" onsubmit="showProgressMessage()">
        <label for="ip">Enter IP Address (X.X.X.X):</label>
        <input type="text" id="ip" name="ip" required>
        
        <label for="ports">Enter Ports (comma-separated):</label>
        <input type="text" id="ports" name="ports" placeholder="e.g., 80,443,8080" required>

        <label for="target_name">Enter Unique Target Name (e.g. Linux):</label>
        <input type="text" id="target_name" name="target_name" required>

        <label for="task_name">Enter Unique Task Name (e.g. Linux):</label>
        <input type="text" id="task_name" name="task_name" required>
        
        <br><br>
        <div class="submit-container">
            <input type="submit" value="Run OpenVAS">
        </div>
        
        <p id="progress-message" style="display:none;">Your scanning is in progress...</p>
    </form>
</body>
</html>
